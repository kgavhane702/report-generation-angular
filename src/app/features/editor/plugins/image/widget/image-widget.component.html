<div class="image-widget" [class.image-widget--error]="imageError">
  <!-- Image Display Mode -->
  <ng-container *ngIf="hasImage && !imageError">
    <img
      [src]="imageProps.src"
      [alt]="imageProps.alt || 'Image'"
      [style.object-fit]="imageFitStyle"
      (error)="handleImageError()"
      (click)="onImageClick()"
      class="image-widget__image"
    />
  </ng-container>

  <!-- Upload/Placeholder Mode -->
  <ng-container *ngIf="!hasImage || imageError">
    <div class="image-widget__placeholder">
      <div class="image-widget__placeholder-content">
        <app-icon
          *ngIf="!isUploading"
          class="image-widget__placeholder-icon"
          name="image_placeholder"
          [size]="48"
        ></app-icon>
        <div *ngIf="isUploading" class="image-widget__loading-spinner"></div>
        <p class="image-widget__placeholder-text">
          {{ imageError ? 'Failed to load image' : isUploading ? 'Uploading...' : 'Click to upload image' }}
        </p>
        <button
          type="button"
          class="image-widget__browse-button"
          (click)="onBrowseClick()"
          [disabled]="isUploading"
        >
          {{ imageError ? 'Try Again' : 'Browse' }}
        </button>
      </div>
    </div>
  </ng-container>

  <!-- Hidden File Input -->
  <input
    #fileInput
    type="file"
    accept="image/*"
    (change)="onFileSelected($event)"
    class="image-widget__file-input"
    aria-label="Select image file"
  />
</div>

