<div class="table-toolbar">
    <div class="table-toolbar__group table-toolbar__group--table-options"
      *ngIf="hasActiveTable">
    <label class="table-toolbar__check">
      <input type="checkbox" [checked]="tableOptions.headerRow" (change)="onToggleHeaderRow($event)" />
      <span>Header Row</span>
    </label>
    <label class="table-toolbar__check">
      <input type="checkbox" [checked]="tableOptions.firstColumn" (change)="onToggleFirstColumn($event)" />
      <span>First Column</span>
    </label>
    <label class="table-toolbar__check">
      <input type="checkbox" [checked]="tableOptions.totalRow" (change)="onToggleTotalRow($event)" />
      <span>Total Row</span>
    </label>
    <label class="table-toolbar__check">
      <input type="checkbox" [checked]="tableOptions.lastColumn" (change)="onToggleLastColumn($event)" />
      <span>Last Column</span>
    </label>
  </div>

  <div class="table-toolbar__separator" *ngIf="hasActiveTable"></div>

  <div class="table-toolbar__group">
    <button
      type="button"
      class="table-toolbar__button table-toolbar__button--wide"
      (mousedown)="openSplitDialog($event)"
      title="Split cell (Rows/Columns)"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="3" width="18" height="18" rx="1"></rect>
        <line x1="3" y1="12" x2="21" y2="12"></line>
        <line x1="12" y1="3" x2="12" y2="21"></line>
      </svg>
      <span class="table-toolbar__button-label">Split</span>
    </button>

    <button
      type="button"
      class="table-toolbar__button table-toolbar__button--wide"
      (mousedown)="onMergeClick($event)"
      title="Merge selected cells (rectangle)"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="6" width="18" height="12" rx="1"></rect>
        <path d="M7 12h10"></path>
        <path d="M9 10l-2 2 2 2"></path>
        <path d="M15 10l2 2-2 2"></path>
      </svg>
      <span class="table-toolbar__button-label">Merge</span>
    </button>

    <button
      type="button"
      class="table-toolbar__button table-toolbar__button--wide"
      (mousedown)="onUnmergeClick($event)"
      title="Unmerge"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="6" width="18" height="12" rx="1"></rect>
        <path d="M7 12h10"></path>
        <path d="M11 9v6"></path>
        <path d="M13 9v6"></path>
      </svg>
      <span class="table-toolbar__button-label">Unmerge</span>
    </button>
  </div>

  <div class="table-toolbar__separator"></div>

  <div class="table-toolbar__group">
    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onInsertRowAbove($event)"
      title="Insert row above"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 10h16"></path>
        <path d="M4 14h16"></path>
        <path d="M12 2v6"></path>
        <path d="M9 5l3-3 3 3"></path>
      </svg>
    </button>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onInsertRowBelow($event)"
      title="Insert row below"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 10h16"></path>
        <path d="M4 14h16"></path>
        <path d="M12 22v-6"></path>
        <path d="M9 19l3 3 3-3"></path>
      </svg>
    </button>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onInsertColLeft($event)"
      title="Insert column left"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10 4v16"></path>
        <path d="M14 4v16"></path>
        <path d="M2 12h6"></path>
        <path d="M5 9l-3 3 3 3"></path>
      </svg>
    </button>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onInsertColRight($event)"
      title="Insert column right"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M10 4v16"></path>
        <path d="M14 4v16"></path>
        <path d="M22 12h-6"></path>
        <path d="M19 9l3 3-3 3"></path>
      </svg>
    </button>

    <div class="table-toolbar__mini-separator" aria-hidden="true"></div>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onDeleteRow($event)"
      title="Delete row"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="3" y="8" width="18" height="8" rx="1"></rect>
        <line x1="8" y1="10" x2="12" y2="14"></line>
        <line x1="12" y1="10" x2="8" y2="14"></line>
      </svg>
    </button>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onDeleteCol($event)"
      title="Delete column"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="8" y="3" width="8" height="18" rx="1"></rect>
        <line x1="10" y1="10" x2="14" y2="14"></line>
        <line x1="14" y1="10" x2="10" y2="14"></line>
      </svg>
    </button>
  </div>

  <div class="table-toolbar__separator"></div>

  <!-- Shared formatting plugins (source of truth: Editastra) -->
  <app-editastra-toolbar
    [enabledForWidgetTypes]="['table']"
    [pluginList]="sharedFormattingPlugins"
    renderMode="embedded"
  ></app-editastra-toolbar>

  <div class="table-toolbar__separator"></div>

  <div class="table-toolbar__group">
    <!-- Cell Fill Picker (table-specific) -->
    <app-color-picker
      [currentColor]="cellFillColor"
      [colorPalette]="highlightFillPalette"
      icon="format_color_fill"
      [disabled]="!hasActiveCell"
      title="Cell fill"
      (colorSelected)="onCellFillSelected($event)"
    ></app-color-picker>

    <!-- Border (single dropdown with live preview: color + style + width) -->
    <app-border-picker
      [disabled]="!hasActiveCell"
      title="Border"
      [colorPalette]="highlightFillPalette"
      [value]="{ color: borderColor, width: borderWidth, style: borderStyle }"
      (valueChange)="onBorderValueChange($event)"
    ></app-border-picker>
  </div>

  <div class="table-toolbar__separator"></div>

  <div class="table-toolbar__group">
    <button
      type="button"
      class="table-toolbar__button"
      [class.table-toolbar__button--active]="isFormatPainterActive"
      [class.table-toolbar__button--format-painter-active]="isFormatPainterActive"
      (mousedown)="onFormatPainterClick($event)"
      title="Format painter (copy cell formatting)"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="4" y="3" width="10" height="6" rx="1"></rect>
        <path d="M9 9v3"></path>
        <path d="M6 12h6l-1 8h-4l-1-8z"></path>
      </svg>
    </button>
  </div>
</div>

<div
  *ngIf="splitDialogOpen"
  class="table-toolbar__modal-backdrop"
  (mousedown)="closeSplitDialog($event)"
>
  <div class="table-toolbar__modal" (mousedown)="$event.stopPropagation()">
    <div class="table-toolbar__modal-title">Split cell</div>

    <div class="table-toolbar__modal-row">
      <label class="table-toolbar__label">
        Rows
        <input
          class="table-toolbar__input"
          type="number"
          min="1"
          [max]="splitMax"
          [(ngModel)]="splitRows"
        />
      </label>

      <label class="table-toolbar__label">
        Columns
        <input
          class="table-toolbar__input"
          type="number"
          min="1"
          [max]="splitMax"
          [(ngModel)]="splitCols"
        />
      </label>
    </div>

    <div class="table-toolbar__modal-actions">
      <button type="button" class="table-toolbar__action" (mousedown)="closeSplitDialog($event)">
        Cancel
      </button>
      <button type="button" class="table-toolbar__action table-toolbar__action--primary" (mousedown)="confirmSplit($event)">
        OK
      </button>
    </div>
  </div>
</div>

