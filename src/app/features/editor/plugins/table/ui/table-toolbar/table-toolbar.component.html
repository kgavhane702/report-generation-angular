<div class="table-toolbar">
  <div class="table-toolbar__group table-toolbar__group--table-options" *ngIf="hasActiveTable">
    <label class="table-toolbar__check">
      <input type="checkbox" [checked]="tableOptions.headerRow" (change)="onToggleHeaderRow($event)" />
      <span>Header Row</span>
    </label>
    <label class="table-toolbar__check" *ngIf="isUrlTableActive()">
      <input type="checkbox" [checked]="preserveHeaderOnUrlLoad" (change)="onTogglePreserveHeaderOnUrlLoad($event)" />
      <span>Preserve Header (URL)</span>
    </label>
    <label class="table-toolbar__check">
      <input type="checkbox" [checked]="tableOptions.firstColumn" (change)="onToggleFirstColumn($event)" />
      <span>First Column</span>
    </label>
    <label class="table-toolbar__check">
      <input type="checkbox" [checked]="tableOptions.totalRow" (change)="onToggleTotalRow($event)" />
      <span>Total Row</span>
    </label>
    <label class="table-toolbar__check">
      <input type="checkbox" [checked]="tableOptions.lastColumn" (change)="onToggleLastColumn($event)" />
      <span>Last Column</span>
    </label>
  </div>

  <div class="table-toolbar__separator" *ngIf="hasActiveTable"></div>

  <div class="table-toolbar__group">
    <button
      *ngIf="hasActiveTable"
      type="button"
      class="table-toolbar__button table-toolbar__button--wide"
      (mousedown)="openColumnRulesDialog($event)"
      title="Column conditional rules"
    >
      <app-icon name="tune"></app-icon>
      <span class="table-toolbar__button-label">Rules</span>
    </button>

    <button
      type="button"
      class="table-toolbar__button table-toolbar__button--wide"
      [disabled]="!(canSplit$ | async)"
      (mousedown)="openSplitDialog($event)"
      title="Split cell (Rows/Columns)"
    >
      <app-icon name="table_split"></app-icon>
      <span class="table-toolbar__button-label">Split</span>
    </button>

    <button
      type="button"
      class="table-toolbar__button table-toolbar__button--wide"
      [disabled]="!(canMerge$ | async)"
      (mousedown)="onMergeClick($event)"
      title="Merge selected cells (select 2+ cells)"
    >
      <app-icon name="table_merge"></app-icon>
      <span class="table-toolbar__button-label">Merge</span>
    </button>
  </div>

  <div class="table-toolbar__separator"></div>

  <div class="table-toolbar__group">
    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onInsertRowAbove($event)"
      title="Insert row above"
    >
      <app-icon name="insert_row_above"></app-icon>
    </button>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onInsertRowBelow($event)"
      title="Insert row below"
    >
      <app-icon name="insert_row_below"></app-icon>
    </button>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onInsertColLeft($event)"
      title="Insert column left"
    >
      <app-icon name="insert_col_left"></app-icon>
    </button>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onInsertColRight($event)"
      title="Insert column right"
    >
      <app-icon name="insert_col_right"></app-icon>
    </button>

    <div class="table-toolbar__mini-separator" aria-hidden="true"></div>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onDeleteRow($event)"
      title="Delete row"
    >
      <app-icon name="delete_row" [size]="18"></app-icon>
    </button>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onDeleteCol($event)"
      title="Delete column"
    >
      <app-icon name="delete_col" [size]="18"></app-icon>
    </button>

    <div class="table-toolbar__mini-separator" aria-hidden="true"></div>

    <button
      type="button"
      class="table-toolbar__button"
      [disabled]="!hasActiveCell"
      (mousedown)="onFitRowClick($event)"
      title="Fit row height to content"
    >
      <app-icon name="fit_contain"></app-icon>
    </button>
  </div>

  <div class="table-toolbar__separator"></div>

  <!-- Shared formatting plugins (source of truth: Editastra) -->
  <app-editastra-toolbar
    [enabledForWidgetTypes]="['table']"
    [pluginList]="sharedFormattingPlugins"
    renderMode="embedded"
  ></app-editastra-toolbar>

  <div class="table-toolbar__separator"></div>

  <div class="table-toolbar__group">
    <!-- Cell Fill Picker (table-specific) -->
    <app-color-picker
      [currentColor]="cellFillColor"
      [colorPalette]="highlightFillPalette"
      icon="format_color_fill"
      [disabled]="!hasActiveCell"
      title="Cell fill"
      (colorSelected)="onCellFillSelected($event)"
    ></app-color-picker>

    <!-- Border (single dropdown with live preview: color + style + width) -->
    <app-border-picker
      [disabled]="!hasActiveCell"
      title="Border"
      [colorPalette]="highlightFillPalette"
      [value]="{ color: borderColor, width: borderWidth, style: borderStyle }"
      (valueChange)="onBorderValueChange($event)"
    ></app-border-picker>
  </div>

  <!-- (Format painter removed for now; will be reworked later) -->
</div>

<app-table-column-rules-dialog
  [(open)]="columnRulesDialogOpen"
  [props]="activeTableProps()"
  [columnRules]="activeTableProps()?.columnRules || []"
  (save)="onColumnRulesSave($event)"
></app-table-column-rules-dialog>

<div
  *ngIf="splitDialogOpen"
  class="table-toolbar__modal-backdrop"
  (mousedown)="closeSplitDialog($event)"
>
  <div class="table-toolbar__modal" (mousedown)="$event.stopPropagation()">
    <div class="table-toolbar__modal-title">Split cell</div>

    <div class="table-toolbar__modal-row">
      <label class="table-toolbar__label">
        Rows
        <input
          class="table-toolbar__input"
          type="number"
          min="1"
          [max]="splitMax"
          [(ngModel)]="splitRows"
        />
      </label>

      <label class="table-toolbar__label">
        Columns
        <input
          class="table-toolbar__input"
          type="number"
          min="1"
          [max]="splitMax"
          [(ngModel)]="splitCols"
        />
      </label>
    </div>

    <div class="table-toolbar__modal-actions">
      <button type="button" class="table-toolbar__action" (mousedown)="closeSplitDialog($event)">
        Cancel
      </button>
      <button type="button" class="table-toolbar__action table-toolbar__action--primary" (mousedown)="confirmSplit($event)">
        OK
      </button>
    </div>
  </div>
</div>

