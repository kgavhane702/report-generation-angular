<div
  class="page__surface"
  [class.page__surface--active]="isActive"
  [style.width.px]="widthPx"
  [style.height.px]="heightPx"
  [attr.id]="surfaceId"
>
  <app-guides-overlay [pageId]="pageId" [widthPx]="widthPx" [heightPx]="heightPx"></app-guides-overlay>

  <!-- Fixed Logo at Top Right -->
  <div class="page__logo-placeholder">
    <img
      [src]="displayLogoUrl"
      alt="Logo"
      class="page__logo-image"
    />
  </div>

  <!-- 
    FIXED: Using widgetIds (stable array from granular selector) 
    instead of page.widgets (changes on every widget update)
    
    Each WidgetContainerComponent now selects its own data using widgetId.
    Widget A updating does NOT cause Widget B to re-render.
  -->
  <app-widget-container
    *ngFor="let widgetId of widgetIds(); trackBy: trackByWidgetId"
    [widgetId]="widgetId"
    [pageSize]="pageSize"
    [pageId]="pageId"
    [subsectionId]="subsectionId"
    [pageWidth]="widthPx"
    [pageHeight]="heightPx"
  ></app-widget-container>

  <!-- Fixed Footer Elements at Bottom -->
  <div class="page__footer" *ngIf="footerLeftText || footerCenterText || showPageNumber">
    <!-- Bottom Left Text - Blue -->
    <div class="page__footer-left" *ngIf="footerLeftText">
      {{ footerLeftText }}
    </div>
    <div class="page__footer-left" *ngIf="!footerLeftText"></div>
    
    <!-- Bottom Middle Text -->
    <div class="page__footer-center" *ngIf="footerCenterText || footerSubText">
      <div class="page__footer-center-line" *ngIf="footerCenterText">
        {{ footerCenterText }}
      </div>
      <div class="page__footer-center-line" *ngIf="footerSubText">
        {{ footerSubText }}
      </div>
    </div>
    <div class="page__footer-center" *ngIf="!footerCenterText && !footerSubText"></div>
    
    <!-- Bottom Right - Page Number -->
    <div class="page__footer-right" *ngIf="showPageNumber">
      {{ pageNumber }}
    </div>
    <div class="page__footer-right" *ngIf="!showPageNumber"></div>
  </div>
</div>
