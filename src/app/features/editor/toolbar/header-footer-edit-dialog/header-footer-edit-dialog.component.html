<app-modal
  [open]="open()"
  (openChange)="open.set($event)"
  size="lg"
  title="Settings"
>
  <ng-container appModalBody>
    <div class="header-footer-dialog">
      <!-- Tabs -->
      <div class="header-footer-dialog__tabs">
        <button
          type="button"
          class="header-footer-dialog__tab"
          [class.header-footer-dialog__tab--active]="activeTab() === 'page'"
          (click)="setActiveTab('page')"
        >
          Page
        </button>
        <button
          type="button"
          class="header-footer-dialog__tab"
          [class.header-footer-dialog__tab--active]="activeTab() === 'header'"
          (click)="setActiveTab('header')"
        >
          Header
        </button>
        <button
          type="button"
          class="header-footer-dialog__tab"
          [class.header-footer-dialog__tab--active]="activeTab() === 'footer'"
          (click)="setActiveTab('footer')"
        >
          Footer
        </button>
      </div>

      <!-- Page Tab Content -->
      <div class="header-footer-dialog__content" *ngIf="activeTab() === 'page'">
        <div class="header-footer-dialog__sections-grid header-footer-dialog__sections-grid--page">
          <div class="header-footer-dialog__section header-footer-dialog__section--full">
            <div class="header-footer-dialog__section-title">Layout</div>
            <div class="header-footer-dialog__field">
              <label class="header-footer-dialog__label">Page size preset</label>
              <app-page-layout-selector variant="settings"></app-page-layout-selector>
              <div class="header-footer-dialog__hint">
                Layout applies to the whole document. Orientation is set per-page (Portrait/Landscape).
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Header Tab Content -->
      <div class="header-footer-dialog__content" *ngIf="activeTab() === 'header'">
        <div class="header-footer-dialog__sections-grid">
        <!-- Left Section -->
        <div class="header-footer-dialog__section">
          <div class="header-footer-dialog__section-title">Left</div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text</label>
            <input
              type="text"
              class="header-footer-dialog__input"
              [value]="headerLeftText()"
              (input)="onHeaderTextChange('left', $any($event.target).value)"
              placeholder="Left text"
            />
          </div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text Color</label>
            <app-color-picker
              [currentColor]="headerLeftTextColor()"
              [colorPalette]="colorPalette"
              icon="format_color_text"
              title="Left text color"
              (colorSelected)="headerLeftTextColor.set($event)"
            ></app-color-picker>
          </div>
        </div>

        <!-- Center Section -->
        <div class="header-footer-dialog__section">
          <div class="header-footer-dialog__section-title">Center</div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text</label>
            <input
              type="text"
              class="header-footer-dialog__input"
              [value]="headerCenterText()"
              (input)="onHeaderTextChange('center', $any($event.target).value)"
              placeholder="Center text"
            />
          </div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text Color</label>
            <app-color-picker
              [currentColor]="headerCenterTextColor()"
              [colorPalette]="colorPalette"
              icon="format_color_text"
              title="Center text color"
              (colorSelected)="headerCenterTextColor.set($event)"
            ></app-color-picker>
          </div>
        </div>

        <!-- Right Section -->
        <div class="header-footer-dialog__section">
          <div class="header-footer-dialog__section-title">Right</div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text</label>
            <input
              type="text"
              class="header-footer-dialog__input"
              [value]="headerRightText()"
              (input)="onHeaderTextChange('right', $any($event.target).value)"
              placeholder="Right text"
            />
          </div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text Color</label>
            <app-color-picker
              [currentColor]="headerRightTextColor()"
              [colorPalette]="colorPalette"
              icon="format_color_text"
              title="Right text color"
              (colorSelected)="headerRightTextColor.set($event)"
            ></app-color-picker>
          </div>
        </div>

        <!-- Logo Section (separate row) -->
        <div class="header-footer-dialog__section header-footer-dialog__section--full">
          <div class="header-footer-dialog__section-title">Logo</div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Position</label>
            <select
              class="header-footer-dialog__select"
              [value]="logoPosition()"
              (change)="logoPosition.set($any($event.target).value)"
            >
              <option value="top-left">Top Left</option>
              <option value="top-right">Top Right</option>
              <option value="bottom-left">Bottom Left</option>
              <option value="bottom-right">Bottom Right</option>
            </select>
          </div>

          <div class="header-footer-dialog__field header-footer-dialog__field--row">
            <div class="header-footer-dialog__field">
              <label class="header-footer-dialog__label">Max Width (px)</label>
              <input
                type="number"
                class="header-footer-dialog__input"
                min="10"
                [value]="logoMaxWidthPx() ?? ''"
                (input)="logoMaxWidthPx.set($any($event.target).value === '' ? null : +$any($event.target).value)"
                placeholder="Auto"
              />
            </div>
            <div class="header-footer-dialog__field">
              <label class="header-footer-dialog__label">Max Height (px)</label>
              <input
                type="number"
                class="header-footer-dialog__input"
                min="10"
                [value]="logoMaxHeightPx() ?? ''"
                (input)="logoMaxHeightPx.set($any($event.target).value === '' ? null : +$any($event.target).value)"
                placeholder="Auto"
              />
            </div>
          </div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Logo Image</label>
            <div class="header-footer-dialog__image-upload">
              <div *ngIf="logoImage()" class="header-footer-dialog__image-preview">
                <img [src]="logoImage()" alt="Logo Preview" />
                <button
                  type="button"
                  class="header-footer-dialog__remove-image"
                  (click)="removeLogo()"
                  title="Remove logo"
                >
                  Ã—
                </button>
              </div>
              <input
                type="file"
                accept="image/*"
                (change)="onLogoUpload($event)"
                class="header-footer-dialog__file-input"
                id="logoImage"
              />
              <label for="logoImage" class="header-footer-dialog__file-label">
                <app-icon name="upload_file"></app-icon>
                <span>{{ logoImage() ? 'Change Logo' : 'Upload Logo' }}</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Common Settings -->
        <div class="header-footer-dialog__section header-footer-dialog__section--full">
          <div class="header-footer-dialog__section-title">Settings</div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__checkbox-label">
              <input
                type="checkbox"
                [checked]="headerShowPageNumber()"
                (change)="headerShowPageNumber.set($any($event.target).checked)"
                class="header-footer-dialog__checkbox"
              />
              <span>Show Page Number</span>
            </label>
          </div>
          <div class="header-footer-dialog__field" *ngIf="headerShowPageNumber()">
            <label class="header-footer-dialog__label">Page Number Format</label>
            <select
              class="header-footer-dialog__select"
              [value]="headerPageNumberFormat()"
              (change)="headerPageNumberFormat.set($any($event.target).value)"
            >
              <option *ngFor="let format of pageNumberFormats" [value]="format.value">
                {{ format.label }} ({{ format.example }})
              </option>
            </select>
          </div>
        </div>
        </div>
      </div>

      <!-- Footer Tab Content -->
      <div class="header-footer-dialog__content" *ngIf="activeTab() === 'footer'">
        <div class="header-footer-dialog__sections-grid header-footer-dialog__sections-grid--footer">
        <!-- Left Section -->
        <div class="header-footer-dialog__section">
          <div class="header-footer-dialog__section-title">Left</div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text</label>
            <input
              type="text"
              class="header-footer-dialog__input"
              [value]="footerLeftText()"
              (input)="onFooterTextChange('left', $any($event.target).value)"
              placeholder="Left text"
            />
          </div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text Color</label>
            <app-color-picker
              [currentColor]="footerLeftTextColor()"
              [colorPalette]="colorPalette"
              icon="format_color_text"
              title="Left text color"
              (colorSelected)="footerLeftTextColor.set($event)"
            ></app-color-picker>
          </div>
        </div>

        <!-- Center Section -->
        <div class="header-footer-dialog__section">
          <div class="header-footer-dialog__section-title">Center</div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text</label>
            <input
              type="text"
              class="header-footer-dialog__input"
              [value]="footerCenterText()"
              (input)="onFooterTextChange('center', $any($event.target).value)"
              placeholder="Center text"
            />
          </div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Sub Text</label>
            <input
              type="text"
              class="header-footer-dialog__input"
              [value]="footerCenterSubText()"
              (input)="onFooterSubTextChange($any($event.target).value)"
              placeholder="Center sub text"
            />
          </div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text Color</label>
            <app-color-picker
              [currentColor]="footerCenterTextColor()"
              [colorPalette]="colorPalette"
              icon="format_color_text"
              title="Center text color"
              (colorSelected)="footerCenterTextColor.set($event)"
            ></app-color-picker>
          </div>
        </div>

        <!-- Right Section (Page Number) -->
        <div class="header-footer-dialog__section">
          <div class="header-footer-dialog__section-title">Right</div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__label">Text Color</label>
            <app-color-picker
              [currentColor]="footerRightTextColor()"
              [colorPalette]="colorPalette"
              icon="format_color_text"
              title="Right/Page number color"
              (colorSelected)="footerRightTextColor.set($event)"
            ></app-color-picker>
          </div>
        </div>

        <!-- Common Settings -->
        <div class="header-footer-dialog__section header-footer-dialog__section--full">
          <div class="header-footer-dialog__section-title">Settings</div>
          <div class="header-footer-dialog__field">
            <label class="header-footer-dialog__checkbox-label">
              <input
                type="checkbox"
                [checked]="footerShowPageNumber()"
                (change)="footerShowPageNumber.set($any($event.target).checked)"
                class="header-footer-dialog__checkbox"
              />
              <span>Show Page Number</span>
            </label>
          </div>
          <div class="header-footer-dialog__field" *ngIf="footerShowPageNumber()">
            <label class="header-footer-dialog__label">Page Number Format</label>
            <select
              class="header-footer-dialog__select"
              [value]="footerPageNumberFormat()"
              (change)="footerPageNumberFormat.set($any($event.target).value)"
            >
              <option *ngFor="let format of pageNumberFormats" [value]="format.value">
                {{ format.label }} ({{ format.example }})
              </option>
            </select>
          </div>
        </div>
        </div>
      </div>
    </div>
  </ng-container>

  <ng-container appModalFooter>
    <button
      type="button"
      class="header-footer-dialog__button header-footer-dialog__button--secondary"
      (click)="cancel()"
    >
      Cancel
    </button>
    <button
      type="button"
      class="header-footer-dialog__button header-footer-dialog__button--primary"
      (click)="save()"
      [disabled]="documentLocked()"
      [title]="documentLocked() ? 'Document is locked' : 'Save'"
    >
      Save
    </button>
  </ng-container>
</app-modal>