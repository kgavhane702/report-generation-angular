<div class="page-outline">
  <div class="page-outline__header">
    <h3>Pages</h3>
    <button type="button" (click)="addPage()" [disabled]="!activeSubsectionId() || isDocumentLocked">
      + Page
    </button>
  </div>
  <div class="page-outline__list" *ngIf="activeSubsectionId() as subsectionId">
    <div
      class="page-outline__item"
      *ngFor="let page of pages(); trackBy: trackByPageId"
      [class.page-outline__item--active]="activePageId() === page.id"
      (click)="selectPage(page.id)"
    >
      <ng-container *ngIf="editingPageId === page.id; else pageLabel">
        <input
          class="page-outline__input"
          [value]="editingPageValue"
          (click)="$event.stopPropagation()"
          (input)="editingPageValue = $any($event.target).value"
          (blur)="savePageTitle(page.id)"
          (keydown.enter)="savePageTitle(page.id)"
          (keydown.escape)="cancelPageEdit()"
        />
      </ng-container>
      <ng-template #pageLabel>
        <div class="page-outline__title">
          {{ displayTitle(page) }}
        </div>
        <div class="page-outline__meta">
          <span class="page-outline__widgets">{{ getWidgetCount(page.id) }}</span>
          <div class="page-outline__orientation">
            <button
              type="button"
              class="page-outline__orientation-btn"
              [class.page-outline__orientation-btn--active]="page.orientation === 'landscape' || !page.orientation"
              (click)="setPageOrientation(page.id, 'landscape', $event)"
              title="Landscape (wider)"
              [disabled]="isDocumentLocked"
            >
              ⬌
            </button>
            <button
              type="button"
              class="page-outline__orientation-btn"
              [class.page-outline__orientation-btn--active]="page.orientation === 'portrait'"
              (click)="setPageOrientation(page.id, 'portrait', $event)"
              title="Portrait (taller)"
              [disabled]="isDocumentLocked"
            >
              ⬍
            </button>
          </div>
          <button type="button" (click)="startPageEdit(page, $event)" [disabled]="isDocumentLocked">✎</button>
          <button
            type="button"
            (click)="deletePage(subsectionId, page.id, $event, pages().length)"
            [disabled]="pages().length <= 1 || isDocumentLocked"
          >
            ✕
          </button>
        </div>
      </ng-template>
    </div>
  </div>
</div>
