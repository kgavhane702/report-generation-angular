<ng-template #content>
  <ng-container *ngFor="let g of pluginGroups(); trackBy: trackByGroup; let isLast = last">
    <div class="table-toolbar__group">
      <ng-container *ngFor="let p of g.items; trackBy: trackByPlugin">
        <ng-container [ngSwitch]="$any(p).kind">
          <!-- Toggle formatting -->
          <button
            *ngSwitchCase="'toggle'"
            type="button"
            class="table-toolbar__button"
            [class.table-toolbar__button--active]="formatTriState($any(p).stateKey) === 'on'"
            [class.table-toolbar__button--mixed]="formatTriState($any(p).stateKey) === 'mixed'"
            [disabled]="!hasActiveEditor"
            (mousedown)="onFormatToggleClick($event, $any(p).command)"
            [attr.title]="$any(p).title"
          >
            <ng-container [ngSwitch]="$any(p).icon">
              <app-icon *ngSwitchCase="'bold'" name="bold"></app-icon>

              <app-icon *ngSwitchCase="'italic'" name="italic"></app-icon>

              <app-icon *ngSwitchCase="'underline'" name="underline"></app-icon>

              <app-icon *ngSwitchCase="'strikethrough'" name="strikethrough"></app-icon>

              <app-icon *ngSwitchCase="'superscript'" name="superscript"></app-icon>

              <app-icon *ngSwitchCase="'subscript'" name="subscript"></app-icon>
            </ng-container>
          </button>

          <!-- Vertical align buttons -->
          <button
            *ngSwitchCase="'vAlign'"
            type="button"
            tabindex="-1"
            class="table-toolbar__button"
            [class.table-toolbar__button--active]="formattingState.verticalAlign === $any(p).value"
            [class.table-toolbar__button--mixed]="formattingState.verticalAlign === 'mixed'"
            [disabled]="!hasActiveEditor"
            (mousedown)="onVerticalAlignClick($event, $any(p).value)"
            [attr.title]="$any(p).title"
          >
            <ng-container [ngSwitch]="$any(p).icon">
              <app-icon *ngSwitchCase="'vAlignTop'" name="vAlignTop"></app-icon>
              <app-icon *ngSwitchCase="'vAlignMiddle'" name="vAlignMiddle"></app-icon>
              <app-icon *ngSwitchCase="'vAlignBottom'" name="vAlignBottom"></app-icon>
            </ng-container>
          </button>

          <!-- Indent buttons -->
          <button
            *ngSwitchCase="'indent'"
            type="button"
            class="table-toolbar__button"
            [disabled]="!hasActiveEditor"
            (mousedown)="onIndentClick($event, $any(p).command)"
            [attr.title]="$any(p).title"
          >
            <ng-container [ngSwitch]="$any(p).icon">
              <app-icon *ngSwitchCase="'indentDecrease'" name="indentDecrease"></app-icon>
              <app-icon *ngSwitchCase="'indentIncrease'" name="indentIncrease"></app-icon>
            </ng-container>
          </button>

          <!-- Mini separator inside a group -->
          <div *ngSwitchCase="'mini-separator'" class="table-toolbar__mini-separator" aria-hidden="true"></div>

          <!-- Bullet style dropdown -->
          <div *ngSwitchCase="'bullet-dropdown'" class="table-toolbar__combo-wrap" title="Bullet list style">
            <button
              #bulletStyleTrigger
              type="button"
              class="table-toolbar__button"
              (mousedown)="onBulletListClick($event)"
              [disabled]="!hasActiveEditor"
              [attr.title]="$any(p).title"
            >
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="4" cy="6" r="1.5" fill="currentColor"></circle>
                <circle cx="4" cy="12" r="1.5" fill="currentColor"></circle>
                <circle cx="4" cy="18" r="1.5" fill="currentColor"></circle>
                <path d="M9 6h12"></path>
                <path d="M9 12h12"></path>
                <path d="M9 18h12"></path>
              </svg>
              <svg class="editastra-toolbar__dropdown-caret" width="8" height="8" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                <path d="M4 6l4 4 4-4z" />
              </svg>
            </button>

            <app-anchored-dropdown [open]="bulletStyleDropdownOpen()" [anchor]="bulletStyleTrigger" (closed)="closeBulletStyleDropdown()">
              <div class="editastra-toolbar__bullet-dropdown" data-editastra-dropdown="1">
                <button
                  *ngFor="let style of bulletStyles"
                  type="button"
                  class="editastra-toolbar__bullet-option"
                  (mousedown)="$event.preventDefault()"
                  (click)="onBulletStyleSelect(style.value)"
                >
                  <span class="editastra-toolbar__bullet-icon">{{ style.icon }}</span>
                  <span class="editastra-toolbar__bullet-label">{{ style.label }}</span>
                </button>
              </div>
            </app-anchored-dropdown>
          </div>

          <!-- Numbered list -->
          <button
            *ngSwitchCase="'numbered-list'"
            type="button"
            class="table-toolbar__button"
            [disabled]="!hasActiveEditor"
            (mousedown)="onNumberedListClick($event)"
            [attr.title]="$any(p).title"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <text x="2" y="8" font-size="7" fill="currentColor" stroke="none">1</text>
              <text x="2" y="14" font-size="7" fill="currentColor" stroke="none">2</text>
              <text x="2" y="20" font-size="7" fill="currentColor" stroke="none">3</text>
              <path d="M9 6h12"></path>
              <path d="M9 12h12"></path>
              <path d="M9 18h12"></path>
            </svg>
          </button>

          <!-- Insert image -->
          <button
            *ngSwitchCase="'insert-image'"
            type="button"
            class="table-toolbar__button"
            [disabled]="!hasActiveEditor"
            (mousedown)="onInsertImageClick($event)"
            [attr.title]="$any(p).title"
          >
            <app-icon [name]="$any(p).icon"></app-icon>
          </button>

          <!-- Reset selected image size -->
          <button
            *ngSwitchCase="'reset-image-size'"
            type="button"
            class="table-toolbar__button"
            [disabled]="!hasActiveEditor"
            (mousedown)="onResetImageSizeClick($event)"
            [attr.title]="$any(p).title"
          >
            <app-icon [name]="$any(p).icon"></app-icon>
          </button>

          <!-- Text align buttons -->
          <button
            *ngSwitchCase="'align'"
            type="button"
            class="table-toolbar__button"
            [class.table-toolbar__button--active]="formattingState.textAlign === $any(p).value"
            [class.table-toolbar__button--mixed]="formattingState.textAlign === 'mixed'"
            [disabled]="!hasActiveEditor"
            (mousedown)="onAlignClick($event, $any(p).value)"
            [attr.title]="$any(p).title"
          >
            <ng-container [ngSwitch]="$any(p).icon">
              <app-icon *ngSwitchCase="'alignLeft'" name="alignLeft"></app-icon>
              <app-icon *ngSwitchCase="'alignCenter'" name="alignCenter"></app-icon>
              <app-icon *ngSwitchCase="'alignRight'" name="alignRight"></app-icon>
              <app-icon *ngSwitchCase="'alignJustify'" name="alignJustify"></app-icon>
            </ng-container>
          </button>

          <!-- Heading style -->
          <div *ngSwitchCase="'heading'" class="table-toolbar__combo-wrap" [attr.title]="$any(p).title">
            <button
              #headingTrigger
              type="button"
              class="editastra-toolbar__combo"
              [disabled]="!hasActiveEditor"
              (mousedown)="openHeadingDropdown($event)"
            >
              <span class="editastra-toolbar__combo-value">{{ headingLabel }}</span>
              <svg width="8" height="8" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                <path d="M4 6l4 4 4-4z" />
              </svg>
            </button>
            <app-anchored-dropdown
              [open]="headingDropdownOpen()"
              (openChange)="headingDropdownOpen.set($event)"
              [anchor]="headingTrigger"
              align="auto"
              [minWidthPx]="140"
              [maxWidthPx]="200"
            >
              <div class="editastra-toolbar__heading-dropdown" data-editastra-dropdown="1">
                <button
                  *ngFor="let h of headingStyles"
                  type="button"
                  class="editastra-toolbar__heading-option"
                  [class.editastra-toolbar__heading-option--active]="currentHeadingTag === h.tag"
                  (mousedown)="$event.preventDefault(); onHeadingPick(h.tag)"
                >
                  <span class="editastra-toolbar__heading-preview" [style.fontSize]="h.previewSize">{{ h.label }}</span>
                </button>
              </div>
            </app-anchored-dropdown>
          </div>

          <!-- Font family -->
          <div *ngSwitchCase="'font-family'" class="table-toolbar__combo-wrap" [attr.title]="$any(p).title">
            <button
              #fontFamilyTrigger
              type="button"
              class="editastra-toolbar__combo"
              [disabled]="!hasActiveEditor"
              (mousedown)="openFontFamilyDropdown($event)"
            >
              <span class="editastra-toolbar__combo-value">{{ fontFamilyLabel }}</span>
              <svg width="8" height="8" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                <path d="M4 6l4 4 4-4z" />
              </svg>
            </button>
            <app-anchored-dropdown
              [open]="fontFamilyDropdownOpen()"
              (openChange)="fontFamilyDropdownOpen.set($event)"
              [anchor]="fontFamilyTrigger"
              align="auto"
              [minWidthPx]="200"
              [maxWidthPx]="300"
            >
              <div class="editastra-toolbar__dropdown-list" data-editastra-dropdown="1">
                <button
                  type="button"
                  class="editastra-toolbar__dropdown-item"
                  (mousedown)="$event.preventDefault(); onFontFamilyPick('')"
                >
                  Default
                </button>
                <button
                  *ngFor="let f of fontFamilies"
                  type="button"
                  class="editastra-toolbar__dropdown-item"
                  [style.fontFamily]="f.value"
                  (mousedown)="$event.preventDefault(); onFontFamilyPick(f.value)"
                >
                  {{ f.label }}
                </button>
              </div>
            </app-anchored-dropdown>
          </div>

          <!-- Font size -->
          <div *ngSwitchCase="'font-size'" class="table-toolbar__combo-wrap" [attr.title]="$any(p).title">
            <button
              #fontSizeTrigger
              type="button"
              class="editastra-toolbar__combo editastra-toolbar__combo--small"
              [disabled]="!hasActiveEditor"
              (mousedown)="openFontSizeDropdown($event)"
            >
              <span>{{ fontSizeLabel }}</span>
              <svg width="8" height="8" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                <path d="M4 6l4 4 4-4z" />
              </svg>
            </button>
            <app-anchored-dropdown
              [open]="fontSizeDropdownOpen()"
              (openChange)="fontSizeDropdownOpen.set($event)"
              [anchor]="fontSizeTrigger"
              align="auto"
              [minWidthPx]="140"
              [maxWidthPx]="180"
            >
              <div class="editastra-toolbar__size-dropdown" data-editastra-dropdown="1">
                <input
                  #customSizeInput
                  type="text"
                  class="editastra-toolbar__size-input"
                  placeholder="Size"
                  (mousedown)="$event.stopPropagation()"
                  (focus)="$event.stopPropagation()"
                  (keydown.enter)="onCustomFontSize(customSizeInput.value); customSizeInput.value = ''"
                />
                <div class="editastra-toolbar__size-presets">
                  <button type="button" class="editastra-toolbar__size-preset" (mousedown)="$event.preventDefault(); onFontSizePick(null)">
                    Auto
                  </button>
                  <button
                    *ngFor="let s of fontSizes"
                    type="button"
                    class="editastra-toolbar__size-preset"
                    (mousedown)="$event.preventDefault(); onFontSizePick(s)"
                  >
                    {{ s }}
                  </button>
                </div>
              </div>
            </app-anchored-dropdown>
          </div>

          <!-- Line height -->
          <div *ngSwitchCase="'line-height'" class="table-toolbar__combo-wrap" [attr.title]="$any(p).title">
            <button
              #lineHeightTrigger
              type="button"
              class="editastra-toolbar__combo editastra-toolbar__combo--icon"
              [disabled]="!hasActiveEditor"
              (mousedown)="openLineHeightDropdown($event)"
            >
              <app-icon name="lineHeight"></app-icon>
            </button>
            <app-anchored-dropdown
              [open]="lineHeightDropdownOpen()"
              (openChange)="lineHeightDropdownOpen.set($event)"
              [anchor]="lineHeightTrigger"
              align="auto"
              [minWidthPx]="90"
              [maxWidthPx]="120"
            >
              <div class="editastra-toolbar__line-height-dropdown" data-editastra-dropdown="1">
                <button
                  *ngFor="let lh of lineHeights"
                  type="button"
                  class="editastra-toolbar__line-height-item"
                  (mousedown)="$event.preventDefault(); onLineHeightPick(lh)"
                >
                  {{ lh }}
                </button>
              </div>
            </app-anchored-dropdown>
          </div>

          <!-- Color pickers -->
          <ng-container *ngSwitchCase="'color'">
            <app-color-picker
              *ngIf="$any(p).colorKind === 'text'"
              [currentColor]="textColor"
              [colorPalette]="textColorPalette"
              [disabled]="!hasActiveEditor"
              [icon]="$any(p).icon"
              [title]="$any(p).title"
              dropdownId="editastra"
              (colorSelected)="onTextColorSelected($event)"
            ></app-color-picker>

            <app-color-picker
              *ngIf="$any(p).colorKind === 'highlight'"
              [currentColor]="highlightColor"
              [colorPalette]="highlightPalette"
              [disabled]="!hasActiveEditor"
              [icon]="$any(p).icon"
              [title]="$any(p).title"
              dropdownId="editastra"
              (colorSelected)="onHighlightSelected($event)"
            ></app-color-picker>
          </ng-container>

          <!-- Widget background color (Editastra widget) -->
          <ng-container *ngSwitchCase="'widget-background'">
            <app-color-picker
              [currentColor]="currentBackgroundColor()"
              [colorPalette]="backgroundPalette"
              [disabled]="!isSupportedWidgetActive()"
              [icon]="$any(p).icon"
              [title]="$any(p).title"
              dropdownId="editastra"
              (colorSelected)="onBackgroundColorSelected($event)"
            ></app-color-picker>
          </ng-container>

        </ng-container>
      </ng-container>
    </div>

    <div class="table-toolbar__separator" *ngIf="!isLast"></div>
  </ng-container>
</ng-template>

<ng-container *ngIf="renderMode === 'standalone'; else embedded">
  <div class="table-toolbar editastra-toolbar" data-editastra-toolbar="1">
    <ng-container *ngTemplateOutlet="content"></ng-container>
  </div>
</ng-container>

<ng-template #embedded>
  <ng-container *ngTemplateOutlet="content"></ng-container>
</ng-template>

<!-- Hidden file input for inserting images -->
<input
  #imageFileInput
  type="file"
  accept="image/*"
  style="display: none"
  (change)="onImageFileSelected($event)"
/>


