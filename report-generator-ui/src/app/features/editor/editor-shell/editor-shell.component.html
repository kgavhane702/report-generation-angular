<div
  class="editor-shell"
  [style.--editor-toolbar-height.px]="52"
  [style.--editor-rail-width.px]="22"
>
  <div class="editor-shell__export-overlay" *ngIf="showExportOverlay()">
    <div class="editor-shell__export-card" role="status" aria-live="polite">
      <div class="editor-shell__spinner" aria-hidden="true"></div>
      <div class="editor-shell__export-text">
        <div class="editor-shell__export-title">{{ exportUi.message() || 'Exporting…' }}</div>
        <div class="editor-shell__export-subtitle">Please wait. Do not click or switch sections while export is running.</div>
      </div>
    </div>
  </div>

  <header class="editor-shell__toolbar">
    <app-editor-toolbar></app-editor-toolbar>
  </header>

  <div class="editor-shell__widget-toolbar" *ngIf="showWidgetToolbar()">
    <app-widget-toolbar></app-widget-toolbar>
  </div>
  
  <div class="editor-shell__body" appScrollMetrics #scrollMetrics="scrollMetrics">
    <aside class="editor-shell__sidebar">
      <div class="editor-shell__sidebar-location" role="status" aria-live="polite">
        <div class="editor-shell__sidebar-location-label">You are here</div>
        <div class="editor-shell__sidebar-location-path" [title]="locationText()">
          <button
            type="button"
            class="editor-shell__sidebar-location-link"
            (click)="onLocationSectionClick()"
            [disabled]="!editorState.activeSectionId()"
            [title]="location().sectionTitle"
          >
            {{ location().sectionTitle }}
          </button>
          <span class="editor-shell__sidebar-location-sep" aria-hidden="true">›</span>
          <button
            type="button"
            class="editor-shell__sidebar-location-link"
            (click)="onLocationSubsectionClick()"
            [disabled]="!editorState.activeSubsectionId()"
            [title]="location().subsectionTitle"
          >
            {{ location().subsectionTitle }}
          </button>
          <ng-container *ngIf="location().pageTitle">
            <span class="editor-shell__sidebar-location-sep" aria-hidden="true">›</span>
            <button
              type="button"
              class="editor-shell__sidebar-location-link editor-shell__sidebar-location-link--current"
              (click)="onLocationPageClick()"
              [disabled]="!editorState.activePageId()"
              [title]="location().pageTitle"
            >
              {{ location().pageTitle }}
            </button>
          </ng-container>
        </div>
      </div>

      <div class="editor-shell__sidebar-content">
        <app-editor-breadcrumb></app-editor-breadcrumb>
      </div>
    </aside>

    <main class="editor-shell__canvas" (contextmenu)="onCanvasContextMenu($event)">
      <app-page-canvas></app-page-canvas>

      <app-context-menu
        [open]="canvasMenuOpen"
        [x]="canvasMenuX"
        [y]="canvasMenuY"
        [items]="canvasContextMenuItems"
        (openChange)="canvasMenuOpen = $event"
        (itemSelected)="onCanvasMenuItemSelected($event)"
      ></app-context-menu>

      <!-- Pinned PPT-style slide navigator (not affected by zoom) -->
      <app-fixed-right-rail *ngIf="pageIds().length > 1">
        <app-slide-navigator
          [totalPages]="pageIds().length"
          [currentIndex]="currentPageIndex()"
          [scrollTop]="scrollMetrics.scrollTop()"
          [scrollHeight]="scrollMetrics.scrollHeight()"
          [clientHeight]="scrollMetrics.clientHeight()"
          (pageChange)="onCanvasPageChange($event)"
          (scrollTo)="onNavigatorScrollTo($event)"
          (scrollBy)="onNavigatorScrollBy($event)"
        ></app-slide-navigator>
      </app-fixed-right-rail>
    </main>
  </div>
</div>

